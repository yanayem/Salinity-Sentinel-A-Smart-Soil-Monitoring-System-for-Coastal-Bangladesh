<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login & Signup</title>

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/log_sign.css' %}" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body>
    {% include "nav.html" %}

    <section class="auth-container">
      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <p class="{{ message.tags }}">{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <div class="card-3d-wrapper" id="card-wrapper">
        <!-- LOGIN CARD -->
        <div class="card front" id="loginCard">
          <h1>Welcome Back</h1>
          <form id="loginForm" method="post" action="{% url 'login_signup' %}">
            {% csrf_token %}
            <div class="input-group">
              <i class="fa fa-envelope"></i>
              <input
                type="email"
                name="username"
                id="loginEmail"
                placeholder="Email Address"
                required
              />
            </div>

            <div class="input-group password-group">
              <i class="fa fa-lock"></i>
              <input
                type="password"
                id="loginPassword"
                placeholder="Password"
                name="password"
                required
              />
              <span
                class="toggle-pass"
                onclick="togglePassword('loginPassword', this)"
              >
                <i class="fa fa-eye"></i>
              </span>
            </div>

            <label class="checkbox">
              <input type="checkbox" /> Remember me
            </label>

            <p class="forgot-pass">
              <a href="">Forgot Password?</a>
            </p>

            <button type="submit" name="login_submit" class="form_btn">
              Log In
            </button>

            <p class="switch-text">
              Donâ€™t have an account?
              <a href="#" id="toSignup">Sign Up</a>
            </p>

            <div class="divider"><span>Or Log in with</span></div>

            <div class="social-buttons">
              <button type="button" class="social google">
                <i class="fab fa-google"></i>
              </button>
              <button type="button" class="social facebook">
                <i class="fab fa-facebook-f"></i>
              </button>
              <button type="button" class="social pinterest">
                <i class="fab fa-pinterest-p"></i>
              </button>
            </div>
          </form>
        </div>

        <!-- SIGNUP CARD -->
        <div class="card back" id="signupCard">
          <h1>Create Account</h1>
          <form
            id="signupForm"
            method="post"
            action="{% url 'login_signup' %}?mode=signup"
          >
            {% csrf_token %}

            <div class="input-group">
              <i class="fa fa-user"></i>
              <input
                type="text"
                id="fullName"
                placeholder="Full Name"
                name="full_name"
                required
              />
            </div>

            <div class="input-group">
              <i class="fa fa-envelope"></i>
              <input
                type="email"
                id="signupEmail"
                placeholder="Email Address"
                name="email"
                required
              />
            </div>

            <div class="input-group password-group">
              <i class="fa fa-lock"></i>
              <input
                type="password"
                id="signupPassword"
                placeholder="Create Password"
                name="password1"
                required
              />
              <span
                class="toggle-pass"
                onclick="togglePassword('signupPassword', this)"
              >
                <i class="fa fa-eye"></i>
              </span>
            </div>

            <div class="input-group password-group">
              <i class="fa fa-lock"></i>
              <input
                type="password"
                id="confirmPassword"
                placeholder="Confirm Password"
                name="password2"
                required
              />
              <span
                class="toggle-pass"
                onclick="togglePassword('confirmPassword', this)"
              >
                <i class="fa fa-eye"></i>
              </span>
            </div>

            <div class="input-group">
              <i class="fa fa-map-marker-alt"></i>
              <input
                type="text"
                name="location"
                placeholder="Location"
                required
              />
            </div>

            <div class="options small">
              <label>
                <input
                  type="checkbox"
                  id="agreeTerms"
                  name="agreeTerms"
                  required
                />
                I agree to the
                <a href="{% url 'terms_privacy' %}" target="_blank" class="link"
                  >Terms & Privacy Policy</a
                >
              </label>
            </div>

            <input type="hidden" name="username" id="username_hidden" />

            <button type="submit" name="signup_submit" class="form_btn">
              Sign Up
            </button>

            <p class="switch-text">
              Already have an account?
              <a href="#" id="toLogin">Log In</a>
            </p>

            <div class="divider"><span>Or sign up with</span></div>

            <div class="social-buttons">
              <button type="button" class="social google">
                <i class="fab fa-google"></i>
              </button>
              <button type="button" class="social facebook">
                <i class="fab fa-facebook-f"></i>
              </button>
              <button type="button" class="social pinterest">
                <i class="fab fa-pinterest-p"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <script>
      const card = document.getElementById("card-wrapper");

      // Determine mode from Django variable or URL
      const djangoMode = "{{ mode|default:'' }}";
      const params = new URLSearchParams(window.location.search);
      const urlMode = params.get("mode");
      const mode = djangoMode || urlMode || "login";

      if (mode === "signup") {
        card.classList.add("flipped");
      } else {
        card.classList.remove("flipped");
      }

      const toSignup = document.getElementById("toSignup");
      const toLogin = document.getElementById("toLogin");
      if (toSignup && toLogin) {
        toSignup.addEventListener("click", (e) => {
          e.preventDefault();
          card.classList.add("flipped");
        });
        toLogin.addEventListener("click", (e) => {
          e.preventDefault();
          card.classList.remove("flipped");
        });
      }

      const emailInput = document.querySelector('input[name="email"]');
      const usernameInput = document.getElementById("username_hidden");
      if (emailInput && usernameInput) {
        emailInput.addEventListener("input", () => {
          usernameInput.value = emailInput.value;
        });
      }
    </script>
    <script src="/static/js/log_sign.js"></script>
  </body>
</html>
