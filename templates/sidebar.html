{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Soil Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Smooth slide toggle */
      .group ul {
        transition: max-height 0.3s ease;
        overflow: hidden;
      }
    </style>
  </head>
  <body class="flex">
    <!-- Sidebar -->
    <nav class="h-screen w-64 bg-[#1a1a2e] text-white fixed top-0 left-0 flex flex-col transition-width duration-300">
      <div class="text-2xl font-bold text-center py-5 bg-[#162447]">
        Soil Monitor
      </div>

      <ul class="flex-1 overflow-y-auto">
        <!-- Dashboard -->
        <li class="{% if request.resolver_match.url_name == 'dashboard' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'dashboard' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Dashboard</a>
        </li>

        <!-- Sensors group -->
        <li class="group">
          <span onclick="toggleGroup(this)" class="block px-5 py-3 font-bold cursor-pointer bg-[#0f3460]">
            Sensors ▾
          </span>
          <ul class="max-h-0 pl-5 bg-[#162447]">
            <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'ph_levels' %}bg-[#e94560] font-bold{% endif %}">
              <a href="{% url 'soildata:ph_levels' %}" class="block px-5 py-2 hover:bg-[#0f3460]">pH Levels</a>
            </li>
            <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'soil_moisture' %}bg-[#e94560] font-bold{% endif %}">
              <a href="{% url 'soildata:soil_moisture' %}" class="block px-5 py-2 hover:bg-[#0f3460]">Soil Moisture</a>
            </li>
            <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'temperature_page' %}bg-[#e94560] font-bold{% endif %}">
              <a href="{% url 'soildata:temperature_page' %}" class="block px-5 py-2 hover:bg-[#0f3460]">Temperature</a>
            </li>
            <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'humidity_page' %}bg-[#e94560] font-bold{% endif %}">
              <a href="{% url 'soildata:humidity_page' %}" class="block px-5 py-2 hover:bg-[#0f3460]">Humidity</a>
            </li>
          </ul>
        </li>

        <!-- Devices -->
        <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'devices' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'soildata:devices' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Devices</a>
        </li>

        <!-- Live Data -->
        <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'live_data' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'soildata:live_data' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Live Data</a>
        </li>

        <!-- Alerts -->
        <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'alerts_page' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'soildata:alerts_page' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Alerts</a>
        </li>

        <!-- Crop Advisor -->
        <li class="{% if request.resolver_match.namespace == 'soildata' and request.resolver_match.url_name == 'crop_advisor' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'soildata:crop_advisor' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Crop Advisor</a>
        </li>

        <!-- ChatBot Assistance -->
        <li class="{% if request.resolver_match.namespace == 'chat' and request.resolver_match.url_name == 'chat_new' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'chat_new' %}" class="block px-5 py-3 hover:bg-[#0f3460]">ChatBot Assistance</a>
        </li>

        <!-- Settings -->
        <li class="{% if request.resolver_match.url_name == 'settingpage' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'settingpage' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Settings</a>
        </li>

        <!-- Profile -->
        <li class="{% if request.resolver_match.url_name == 'profilepage' %}bg-[#e94560] font-bold{% endif %}">
          <a href="{% url 'profilepage' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Profile</a>
        </li>

        <!-- Logout -->
        <li>
          <a href="{% url 'logout' %}" class="block px-5 py-3 hover:bg-[#0f3460]">Logout</a>
        </li>
      </ul>
    </nav>

    <script>
      function toggleGroup(el){
        const ul = el.nextElementSibling;
        if(ul.style.maxHeight && ul.style.maxHeight !== "0px"){
          ul.style.maxHeight = "0px";
          el.innerText = el.innerText.replace("▴","▾");
        } else {
          ul.style.maxHeight = ul.scrollHeight + "px";
          el.innerText = el.innerText.replace("▾","▴");
        }
      }

      // Auto-expand active group
      document.querySelectorAll(".group").forEach(group=>{
        const activeLink = group.querySelector(".bg-[#e94560]");
        if(activeLink){
          const ul = group.querySelector("ul");
          ul.style.maxHeight = ul.scrollHeight + "px";
          const span = group.querySelector("span");
          span.innerText = span.innerText.replace("▾","▴");
        }
      });
    </script>
  </body>
</html>
