{% load static %}
 {% include 'sidebar.html' %}

{% block content %}
<div class="container" style="padding: 20px;">
    <h1>ðŸŒ¡ Temperature & Crop Advisor Dashboard</h1>

    <!-- Device Cards -->
    <div class="devices-cards" id="device-cards" style="display: flex; flex-wrap: wrap; gap: 20px;"></div>
</div>

<style>
    body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background-color: #f5f5f5;
}

.container {
    margin-left: 250px; /* adjust to sidebar width */
    padding: 20px;
}
.device-card {
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 12px;
    width: 250px;
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
    transition: transform 0.2s;
}
.device-card:hover { transform: scale(1.05); }
.temp-normal { background-color: #d4edda; }   /* green */
.temp-high { background-color: #f8d7da; }     /* red */
.temp-low { background-color: #cce5ff; }      /* blue */
.device-name { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; }
.temp-value { font-size: 2rem; font-weight: bold; margin-bottom: 5px; }
.timestamp { font-size: 0.85rem; color: #555; margin-bottom: 10px; }
.suggestion { font-size: 0.9rem; font-weight: 500; }
.region { font-size: 0.85rem; color: #333; margin-top: 5px; }
</style>

<script>
// ===== SAMPLE DEVICES & TEMPERATURES =====
const devices = [
    {id:1, name:"Device 1", region:"North Bangladesh", soilType:"Loamy"},
    {id:2, name:"Device 2", region:"Central Bangladesh", soilType:"Clay"},
    {id:3, name:"Device 3", region:"South Bangladesh", soilType:"Sandy"}
];

let latestReadings = [
    {deviceId:1, temperature:28, updated_at:"10:30 25-10-2025"},
    {deviceId:2, temperature:35, updated_at:"10:32 25-10-2025"},
    {deviceId:3, temperature:20, updated_at:"10:35 25-10-2025"}
];

// ===== SUGGESTION FUNCTION BASED ON TEMP =====
function suggestCrop(temp) {
    if(temp > 32) return "Plant heat-tolerant crops or mango trees ðŸŒ³";
    if(temp < 22) return "Plant cool-weather crops or guava trees ðŸ";
    return "Optimal for vegetables and fruit trees ðŸŒ±";
}

// ===== RENDER DEVICE CARDS =====
function renderCards() {
    const container = document.getElementById("device-cards");
    container.innerHTML = "";
    devices.forEach(device => {
        const latest = latestReadings.find(r => r.deviceId===device.id);
        let tempClass = "temp-normal";
        if(latest.temperature > 32) tempClass="temp-high";
        else if(latest.temperature < 22) tempClass="temp-low";

        const card = document.createElement("div");
        card.className = `device-card ${tempClass}`;
        card.innerHTML = `
            <div class="device-name">${device.name}</div>
            <div class="temp-value">${latest.temperature}Â°C</div>
            <div class="region">${device.region} | ${device.soilType} soil</div>
            <div class="suggestion">${suggestCrop(latest.temperature)}</div>
            <div class="timestamp">Last updated: ${latest.updated_at}</div>
        `;
        container.appendChild(card);
    });
}

// ===== INITIAL RENDER =====
renderCards();

// ===== SIMULATE LIVE UPDATES =====
setInterval(()=>{
    latestReadings = latestReadings.map(r=>({
        ...r,
        temperature: r.temperature + Math.floor(Math.random()*3-1),
        updated_at: new Date().toLocaleTimeString() + " " + new Date().toLocaleDateString()
    }));
    renderCards();
},10000);
</script>

{% endblock %}
