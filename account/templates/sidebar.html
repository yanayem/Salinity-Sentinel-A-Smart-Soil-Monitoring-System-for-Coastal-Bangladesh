{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soil Monitor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="transition-colors duration-500 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">

<!-- Top Bar -->
<header class="fixed top-0 left-0 w-full bg-white dark:bg-[#27374d] shadow-2xl z-50 transition-all">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">

      <!-- Left: Logo + Mobile Menu -->
      <div class="flex items-center space-x-2">
        <button id="mobileMenuBtn" class="md:hidden px-4 transition transform hover:-translate-y-0.5">
          <i class="fas fa-bars text-gray-900 dark:text-white text-lg"></i>
        </button>
        <img src="{% static 'media/logo.png' %}" alt="Logo" class="h-12 w-12 rounded-full shadow-lg">
        <span class="inline text-2xl font-bold text-blue-600 dark:text-blue-400">Soil Monitor</span>
      </div>

      <!-- Right: Theme Toggle + User Info -->
      <div class="flex items-center space-x-4">

        <!-- Theme Toggle -->
        <button id="themeToggle" class="p-2 transition transform hover:-translate-y-0.5">
          <i id="themeIcon" class="fas fa-sun text-yellow-400 text-lg"></i>
        </button>

        <!-- User Profile -->
        <div class="flex items-center space-x-2 bg-white dark:bg-gray-700 rounded-full shadow-md px-2 py-1 hover:shadow-xl transition transform hover:-translate-y-0.5 cursor-pointer">
          <img src="{% if global_profile.profile_pic and global_profile.profile_pic.name %}{{ global_profile.profile_pic.url }}{% else %}https://www.w3schools.com/howto/img_avatar.png{% endif %}"
              alt="Profile Pic"
              class="h-10 w-10 rounded-full object-cover border-2 border-blue-500 shadow-md">
          <span class="font-medium text-gray-900 dark:text-gray-100">{{ global_profile.user.first_name }} {{ global_profile.user.last_name }}</span>
        </div>

      </div>
    </div>
  </div>
</header>

<!-- Sidebar -->
<aside id="sidebarMenu" class="fixed top-16 left-0 w-64 h-full bg-gray-100 dark:bg-[#27374d] text-gray-900 dark:text-white shadow-2xl z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out overflow-y-auto">
  <ul class="flex flex-col mt-4 space-y-1">

    <!-- Dashboard -->
    <li>
      <a href="{% url 'soildata:dashboard' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'dashboard' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-tachometer-alt text-blue-300"></i> Dashboard
      </a>
    </li>

    <!-- Soil Moisture -->
    <li>
      <a href="{% url 'soildata:soil_moisture' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'soil_moisture' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-leaf text-green-400"></i> Soil Moisture
      </a>
    </li>

    <!-- Alerts -->
    <li>
      <a href="{% url 'soildata:alerts' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'alerts' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-bell text-yellow-400"></i> Alerts
      </a>
    </li>

    <!-- Soil Analyzer -->
    <li>
      <a href="{% url 'soilvision:soil_upload' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'soil_upload' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-seedling text-green-500"></i> Soil Analyzer
      </a>
    </li>



    <!-- Crop Advisor -->
    <li>
      <a href="{% url 'soildata:crop_advisor' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'crop_advisor' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa-solid fa-lightbulb text-green-500 dark:text-green-300"></i> Crop Advisor
      </a>
    </li>

    <!-- ChatBot -->
    <li>
      <a href="{% url 'chat_new' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'chat_new' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-comments text-pink-500"></i> ChatBot
      </a>
    </li>

    <!-- Settings -->
    <li>
      <a href="{% url 'account:settingpage' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'settingpage' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-cog text-gray-500"></i> Settings
      </a>
    </li>

    <!-- Profile -->
    <li>
      <a href="{% url 'account:profilepage' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg transition-all hover:bg-[#3a506b] {% if request.resolver_match.url_name == 'profilepage' %}bg-[#3a506b] font-semibold{% endif %}">
        <i class="fa fa-user text-gray-500"></i> Profile
      </a>
    </li>

    <!-- Logout -->
    <li>
      <a href="{% url 'account:logout' %}" class="flex items-center gap-3 px-5 py-3 rounded-lg bg-red-500 hover:bg-red-600 text-white transition-all">
        <i class="fa fa-sign-out-alt"></i> Logout
      </a>
    </li>

  </ul>
</aside>

<!-- Scripts -->
<script>
  // ------------------------
  // Dark / Light Mode Toggle
  // ------------------------
  const html = document.documentElement;
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');

  // Initialize theme from localStorage
  if(localStorage.theme === 'dark') html.classList.add('dark');
  updateThemeIcon();

  function updateThemeIcon(){
    if(themeIcon){ // only if icon exists
      if(html.classList.contains('dark')){
        themeIcon.classList.replace('fa-sun', 'fa-moon');
      } else {
        themeIcon.classList.replace('fa-moon', 'fa-sun');
      }
    }
  }

  function toggleTheme(){
    html.classList.toggle('dark');
    localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
    updateThemeIcon();
  }

  if(themeToggle){
    themeToggle.addEventListener('click', toggleTheme);
  }

  // ------------------------
  // Mobile Sidebar Toggle
  // ------------------------
  const mobileBtn = document.getElementById('mobileMenuBtn');
  const sidebar = document.getElementById('sidebarMenu');

  if(mobileBtn && sidebar){
    mobileBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
    });
  }

  // ------------------------
  // Optional: Close sidebar on outside click (mobile)
  // ------------------------
  document.addEventListener('click', (e) => {
    if(window.innerWidth < 768){ // only mobile
      if(sidebar && !sidebar.contains(e.target) && !mobileBtn.contains(e.target)){
        if(!sidebar.classList.contains('-translate-x-full')){
          sidebar.classList.add('-translate-x-full');
        }
      }
    }
  });

  // ------------------------
  // Optional: Close sidebar on link click (mobile)
  // ------------------------
  const sidebarLinks = sidebar ? sidebar.querySelectorAll('a') : [];
  sidebarLinks.forEach(link => {
    link.addEventListener('click', () => {
      if(window.innerWidth < 768 && sidebar){
        sidebar.classList.add('-translate-x-full');
      }
    });
  });
</script>


</body>
</html>
